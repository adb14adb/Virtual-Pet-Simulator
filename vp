#include <iostream>  // Include library for standard input and output
#include <string>    // Include library for string data handling
#include <iomanip>   // Include library for I/O manipulators like setw
#include <fstream>   // Include library for file stream operations
#include <cstdlib>   // Include library for standard utility functions like system()

using namespace std; // Use the standard namespace

// ======================================================
// 1. CLASS AND OBJECTS (Criteria 6)
// ======================================================
class Pet {          // Define the Pet class
private:             // Private access specifier
    string name;     // Attribute to store pet name
    int health, hunger, happiness, age; // Attributes for pet status

public:              // Public access specifier
    Pet(string petName) { // Constructor to initialize pet object
        name = petName;   // Assign pet name
        health = 100;     // Initial health value
        hunger = 50;      // Initial hunger value
        happiness = 50;   // Initial happiness value
        age = 0;          // Initial age value
    }

    // Accessors (Criteria 4)
    string getName() const { return name; }       // Get pet name
    int getHealth() const { return health; }    // Get health level
    int getHunger() const { return hunger; }    // Get hunger level
    int getHappiness() const { return happiness; } // Get happiness level
    int getAge() const { return age; }          // Get age value

    // Mutator to update stats from loaded file
    void setStats(int h, int hu, int hap, int a) { // Function to set pet stats
        health = h;       // Update health
        hunger = hu;      // Update hunger
        happiness = hap;  // Update happiness
        age = a;          // Update age
    }

    void feed() { // Function to feed the pet
        cout << "\n[Action] You fed " << name << "." << endl; // Output message
        hunger -= 20; // Decrease hunger level
        if (hunger < 0) hunger = 0; // Prevent hunger from dropping below 0
        passTime(); // Progress time after action
    }

    void play() { // Function to play with the pet
        cout << "\n[Action] You played with " << name << "." << endl; // Output message
        happiness += 20; // Increase happiness level
        if (happiness > 100) happiness = 100; // Cap happiness at 100
        hunger += 10; // Increase hunger due to activity
        passTime(); // Progress time after action
    }

    void sleep() { // Function for pet to sleep
        cout << "\n[Action] " << name << " is sleeping..." << endl; // Output message
        health += 15; // Recover health
        if (health > 100) health = 100; // Cap health at 100
        hunger += 5; // Increase hunger during sleep
        passTime(); // Progress time after action
    }

    void passTime() { // Function to simulate time passing
        age++;           // Increase age
        hunger += 5;     // Increase hunger over time
        happiness -= 5;  // Decrease happiness over time

        // INDIRECT DEATH LOGIC
        if (hunger >= 80) health -= 10;   // Lose health if starving
        if (happiness <= 20) health -= 5; // Lose health if neglected

        // SUDDEN DEATH LOGIC (Starvation)
        if (hunger >= 100) health = 0; // Pet dies if hunger hits 100

        // CLAMPING VALUES
        if (happiness < 0) happiness = 0; // Ensure happiness is not negative
        if (hunger > 100) hunger = 100;   // Ensure hunger does not exceed 100
        if (happiness > 100) happiness = 100; // Cap happiness at 100
        if (health < 0) health = 0; // Ensure health is not negative
    }

    void checkStatus() const { // Function to display pet status
        system("cls"); // Clear the console screen
        cout << "==============================================" << endl; // UI line
        cout << "            VIRTUAL PET DASHBOARD             " << endl; // UI header
        cout << "==============================================" << endl; // UI line
        
        // Cat ASCII Art
        if (health > 0) { // Check if pet is alive
            cout << "      |\\__/,|   (`\\  " << endl; // Alive cat head
            cout << "    _.|o o  |_   ) ) " << endl; // Alive cat eyes
            cout << "  -(((---(((-------- " << endl; // Alive cat feet
        } else { // If pet is dead
            cout << "      |\\__/,|        " << endl; // Dead cat head
            cout << "    _.|x x  |_       " << endl; // Dead cat eyes
            cout << "  -(((---(((-------- " << endl; // Dead cat feet
        }

        cout << " Name      : " << name << endl; // Display name
        cout << " Age       : " << age << " cycles" << endl; // Display age
        cout << " Health    : [" << setw(3) << health << "/100]" << endl; // Display health
        cout << " Hunger    : [" << setw(3) << hunger << "/100]" << endl; // Display hunger
        cout << " Happiness : [" << setw(3) << happiness << "/100]" << endl; // Display happiness
        cout << "==============================================" << endl; // UI line

        // WARNING SYSTEM
        if (health > 0) { // Warnings only if alive
            if (happiness <= 20) { // Low happiness warning
                cout << "[WARNING] " << name << " is very bored! Play with it." << endl; // Warning message
            }
            if (hunger >= 80) { // High hunger warning
                cout << "[WARNING] " << name << " is starving! Feed it now." << endl; // Warning message
            }
        }
    }

    bool isAlive() const { // Function to check life status
        return health > 0; // Return true if health > 0
    }
};

// ======================================================
// 2. FILE I/O OPERATIONS (Criteria 2)
// ======================================================
void saveGame(const Pet& pet) { // Function to save pet data to file
    string fileName = pet.getName() + ".txt"; // Create filename based on pet name
    ofstream outFile(fileName); // Open file for writing
    if (outFile.is_open()) { // If file opened successfully
        outFile << "Name: " << pet.getName() << endl; // Save name
        outFile << "Health: " << pet.getHealth() << endl; // Save health
        outFile << "Hunger: " << pet.getHunger() << endl; // Save hunger
        outFile << "Happiness: " << pet.getHappiness() << endl; // Save happiness
        outFile << "Age: " << pet.getAge() << endl; // Save age
        outFile.close(); // Close file
        cout << "\n[System] Game saved to " << fileName << "!" << endl; // Success message
    }
}

bool loadGame(string searchName, string &n, int &h, int &hu, int &hap, int &a) { // Function to load pet data
    string fileName = searchName + ".txt"; // Define filename to look for
    ifstream inFile(fileName); // Open file for reading
    string dummy; // To skip text labels
    if (inFile.is_open()) { // If file found
        if (!(inFile >> dummy)) return false; // Skip "Name:" label
        getline(inFile >> ws, n); // Read pet name
        if (!(inFile >> dummy >> h)) return false; // Read "Health:" and value
        if (!(inFile >> dummy >> hu)) return false; // Read "Hunger:" and value
        if (!(inFile >> dummy >> hap)) return false; // Read "Happiness:" and value
        if (!(inFile >> dummy >> a)) return false; // Read "Age:" and value
        inFile.close(); // Close file
        return true; // Return success
    }
    return false; // Return failure if file not found
}

// ======================================================
// 3. MAIN PROGRAM LOOP
// ======================================================
int main() { // Main entry point
    string name; // Variable for name
    int health, hunger, happiness, age; // Variables for stats
    char loadChoice; // Variable for user choice
    bool loaded = false; // Flag for load status

    cout << "--- VIRTUAL PET SIMULATOR ---" << endl; // Game title

    while (true) { // Input validation loop for loading
        cout << "Do you want to load a pet? (y/n): "; // Prompt message
        cin >> loadChoice; // Get choice
        if (loadChoice == 'y' || loadChoice == 'Y' || loadChoice == 'n' || loadChoice == 'N') break; // Exit if valid
        cout << "[!] Invalid input! Use 'y' or 'n'." << endl; // Error message
        cin.clear(); // Clear cin error state
        cin.ignore(10000, '\n'); // Ignore invalid input
    }

    if (loadChoice == 'y' || loadChoice == 'Y') { // If user wants to load
        string searchName; // Search name variable
        cout << "Enter the name of the pet you want to load: "; // Prompt for name
        cin.ignore(10000, '\n'); // Clear buffer
        getline(cin, searchName); // Read full name

        if (loadGame(searchName, name, health, hunger, happiness, age)) { // Try loading
            cout << "[System] " << name << " loaded successfully!" << endl; // Success message
            loaded = true; // Set flag to true
            cout << "Press Enter to start..."; // Wait prompt
            cin.get(); // Wait for key press
        } else { // If load fails
            cout << "[Error] No save file found for " << searchName << ". Starting new game." << endl; // Error message
        }
    } else { // If user does not want to load
        cin.ignore(10000, '\n'); // Clear buffer
    }

    if (!loaded) { // If no game was loaded
        cout << "Enter your new pet's name: "; // Prompt for new name
        getline(cin, name); // Read new pet name
    }

    Pet myPet(name); // Instantiate Pet object (Criteria 6)
    if (loaded) myPet.setStats(health, hunger, happiness, age); // Apply loaded stats if available

    while (myPet.isAlive()) { // Game loop (Criteria 3)
        myPet.checkStatus(); // Show current dashboard
        cout << "\nActions:" << endl; // Menu header
        cout << "1. Feed" << endl; // Option 1
        cout << "2. Play" << endl; // Option 2
        cout << "3. Sleep" << endl; // Option 3
        cout << "4. Do Nothing" << endl; // Option 4
        cout << "5. Save & Exit" << endl; // Option 5
        cout << "Enter choice (1-5): "; // Prompt for menu

        int choice; // Variable for menu choice
        if (!(cin >> choice)) { // Validate numeric input
            cout << "\n[!] Invalid option! Use numbers (1-5) only." << endl; // Error message
            cout << "Press Enter to try again..."; // Wait prompt
            cin.clear(); // Clear error
            cin.ignore(10000, '\n'); // Clear buffer
            cin.get(); // Wait for key press
            continue; // Restart loop
        }

        if (choice == 5) { // If exit chosen
            saveGame(myPet); // Save data (Criteria 2)
            cout << name << " says goodbye!" << endl; // Exit message
            return 0; // Terminate program
        }

        switch (choice) { // Handle choices (Criteria 3)
            case 1: myPet.feed(); break; // Feed action
            case 2: myPet.play(); break; // Play action
            case 3: myPet.sleep(); break; // Sleep action
            case 4: myPet.passTime(); break; // Just pass time
            default: cout << "Invalid choice!" << endl; // Handle invalid number
        }

        cout << "\nPress Enter to continue..."; // Wait prompt
        cin.ignore(10000, '\n'); // Clear buffer
        cin.get(); // Wait for key press
    }

    myPet.checkStatus(); // Final status display
    cout << "\n[Game Over] Sadly, " << name << " has passed away." << endl; // Death message

    return 0; // Successful execution end
}
