//TEMPLATE UNTUK VIRTUAL PET
//UBAH SAJA APA APA KAMU MAU TAMBAH
#include <iostream>
#include <string>
#include <iomanip>
#include <fstream>
#include <cstdlib> // Untuk rand() dan srand()

using namespace std;

// ======================================================
// KRITERIA 5: ARRAY - Food Item Struct
// ======================================================
struct FoodItem {
    string name;
    int hungerReduction;
    int healthBoost;
    int quantity;
};

// ======================================================
// 1. CLASS AND OBJECTS
// ======================================================

class Pet {
private:
    // Data Members (Ciri-ciri tu Pet)
    string name;
    int health;     // Health (0-100)
    int hunger;     // Hunger (0-100, 100 = Sangat lapar)
    int happiness;  // Happiness (0-100)
    int age;        // Age

    // KRITERIA 5: ARRAY FOR FOOD INVENTORY
    FoodItem foodInventory[5];
    int foodTypes;

public:
    // Constructor
    Pet(string petName) {
        name = petName;
        health = 100;
        hunger = 50;
        happiness = 50;
        age = 0;
        initializeFoodInventory();  // KRITERIA 5
        cout << "\nWelcome, " << name << "! Let's start a new life." << endl;
    }

    // Accessor Functions (Untuk File I/O)
    string getName() const { return name; }
    int getHealth() const { return health; }
    // ... Add other get functions here if needed

    // Mutator Functions
    void setName(string n) { name = n; }
    void setHealth(int h) { health = h; }
    void setHunger(int h) { hunger = h; }
    void setHappiness(int h) { happiness = h; }
    void setAge(int a) { age = a; }

    // ======================================================
    // KRITERIA 5: INITIALIZE FOOD INVENTORY (Array)
    // ======================================================
    void initializeFoodInventory() {
        foodTypes = 5;
        
        foodInventory[0].name = "Apple";
        foodInventory[0].hungerReduction = 15;
        foodInventory[0].healthBoost = 8;
        foodInventory[0].quantity = 5;
        
        foodInventory[1].name = "Meat";
        foodInventory[1].hungerReduction = 30;
        foodInventory[1].healthBoost = 15;
        foodInventory[1].quantity = 3;
        
        foodInventory[2].name = "Fish";
        foodInventory[2].hungerReduction = 25;
        foodInventory[2].healthBoost = 20;
        foodInventory[2].quantity = 4;
        
        foodInventory[3].name = "Vegetable";
        foodInventory[3].hungerReduction = 12;
        foodInventory[3].healthBoost = 10;
        foodInventory[3].quantity = 6;
        
        foodInventory[4].name = "Treat";
        foodInventory[4].hungerReduction = 8;
        foodInventory[4].healthBoost = 2;
        foodInventory[4].quantity = 8;
    }

    // ======================================================
    // KRITERIA 5: VIEW INVENTORY (Array Display)
    // ======================================================
    void viewInventory() const {
        cout << "\n========== Food Inventory ==========" << endl;
        for (int i = 0; i < foodTypes; i++) {
            cout << i + 1 << ". " << foodInventory[i].name 
                 << " - Qty: " << foodInventory[i].quantity << endl;
        }
        cout << "====================================" << endl;
    }

    // ======================================================
    // 4. USER DEFINED FUNCTIONS
    // ======================================================

    void feed() {
        cout << "\n--- Available Food ---" << endl;
        
        // Display food inventory (ARRAY USAGE)
        for (int i = 0; i < foodTypes; i++) {
            cout << i + 1 << ". " << foodInventory[i].name 
                 << " (Qty: " << foodInventory[i].quantity << ")" << endl;
        }
        
        cout << "Choose food (1-5) or 0 to cancel: ";
        int foodChoice;
        cin >> foodChoice;
        
        if (foodChoice < 0 || foodChoice > 5) {
            cout << "Invalid choice!" << endl;
            passTime();
            return;
        }
        
        if (foodChoice == 0) {
            cout << "Cancelled." << endl;
            return;
        }
        
        int index = foodChoice - 1;
        
        // Check if food is available
        if (foodInventory[index].quantity <= 0) {
            cout << "Sorry, we ran out of " << foodInventory[index].name << "!" << endl;
            passTime();
            return;
        }
        
        // Feed the pet with selected food
        hunger -= foodInventory[index].hungerReduction;
        health += foodInventory[index].healthBoost;
        foodInventory[index].quantity--;  // Reduce quantity
        
        if (hunger < 0) hunger = 0;
        if (health > 100) health = 100;
        
        cout << name << " ate " << foodInventory[index].name << " and felt satisfied!" << endl;
        
        passTime();
    }

    void play() {
        // Logic: Increase happiness, increase hunger
        if (happiness < 90) {
            happiness += 15;
            hunger += 10;
            cout << name << " played happily! Woohoo! " << endl;
        } else {
            cout << name << " too happy and tired. " << endl;
        }
        passTime(); // Time change
    }

    void sleep() {
       // Logic: Increase health and happiness, increase hunger slightly
       if (health < 100) {
           health += 20;
           happiness += 10; 
           hunger += 5;
       if (health > 100) health = 100;
       if (happiness > 100) happiness = 100;
           cout << name << " rested well and is fully energized!" << endl;
       } else {
           cout << name << " is not sleepy anymore. Do not oversleep!" << endl;
       }
       passTime(); // Time change
}

    // ======================================================
    // 3. CONTROL STRUCTURES & Game Loop Logic
    // ======================================================

    void passTime() {
        // Logic: Automatic changes and revisions
        age++; // Pet gets older every time an action is taken
        hunger += 5; // Hunger always increasing

        // 3. CONTROL STRUCTURES (Selection)
        if (hunger >= 80) {
            health -= 10;
            cout << "\n[Reminder]: " << name << " is very hungry! Decreased health." << endl;
        }
        if (happiness <= 20) {
            health -= 5;
            cout << "\n[Reminder]: " << name << " is very sad. Decreased health." << endl;
        }

        // Make sure the value is between 0 and 100
        if (health < 0) health = 0;
        if (hunger > 100) hunger = 100;
        if (happiness > 100) happiness = 100;
    }
    
    // Death status check function
    bool isAlive() const {
        return health > 0;
    }

    // ======================================================
    // 1. INPUT/OUTPUT & 7. MANIPULATORS
    // ======================================================

    void checkStatus() const {
    
    // --- PENAMBAHAN BARU: Hapus Layar ---
    #ifdef _WIN32
        system("cls"); // Untuk Windows
    #else
        system("clear"); // Untuk Linux/macOS
    #endif
    
    // --- PENAMBAHAN BARU: Gambar Kucing ---
    displayPetArt(); // Panggil fungsi gambar

    cout << "\n==============================================" << endl;
    cout << "           Current Status " << name << endl;
    cout << "==============================================" << endl;
    // ... (Sisa kode status tetap sama)
    cout << left << setw(15) << "Age:" << right << setw(10) << age << " years old" << endl;
    cout << left << setw(15) << "Health:" << right << setw(10) << health << " / 100" << endl;
    cout << left << setw(15) << "Hunger:" << right << setw(10) << hunger << " / 100" << endl;
    cout << left << setw(15) << "Happiness:" << right << setw(10) << happiness << " / 100" << endl;
    cout << "==============================================" << endl;
}
    
    // Tambahkan fungsi ini di dalam class Pet

void displayPetArt() const {
    // Tentukan gambar berdasarkan status kebahagiaan
    if (health <= 20) {
        cout << " /\\_/\\" << endl;
        cout << "( X.X )  (Sakit...)" << endl;
        cout << " > ^ <" << endl;

    } else if (happiness >= 80) {
        cout << " /\\_/\\" << endl;
        cout << "( o.o )  (Senang!)" << endl;
        cout << " > ^ <" << endl;

    } else if (hunger >= 80) {
        cout << " /\\_/\\" << endl;
        cout << "( -.- )  (Lapar...)" << endl;
        cout << " > ^ <" << endl;

    } else { // Normal/Default
        cout << " /\\_/\\" << endl;
        cout << "( ?.? )  (Hi, " << name << "!)" << endl;
        cout << " > ^ <" << endl;
    }
}
};

// ======================================================
// EXTERNAL FUNCTIONS FOR I/O FILES 
// ======================================================

// 2. File Input/Output to read/write file
void saveGame(const Pet& pet) {
    ofstream outFile("pet_save.txt");
    if (outFile.is_open()) {
        outFile << pet.getName() << endl;
        outFile << pet.getHealth() << endl;
        outFile << pet.getHunger() << endl;
        outFile << pet.getHappiness() << endl;
        outFile << pet.getAge() << endl;
        outFile.close();
        cout << "\n--- Status " << pet.getName() << " successfully saved. ---" << endl;
    } else {
        cout << "Failed to open file to save." << endl;
    }
}
    bool loadGame(Pet& pet) {
    ifstream inFile("pet_save.txt");
    if (inFile.is_open()) {
        string name;
        int health, hunger, happiness, age;
        if (inFile >> name >> health >> hunger >> happiness >> age) {
            pet.setName(name);
            pet.setHealth(health);
            pet.setHunger(hunger);
            pet.setHappiness(happiness);
            pet.setAge(age);
            inFile.close();
            cout << "\n--- Status " << pet.getName() << " successfully loaded. ---" << endl;
            return true; 
        } else {
            cout << "Failed to read data from save file." << endl;
            inFile.close();
            return false;
        }
    } else {
        cout << "Failed to open save file to load. Starting new game." << endl;
        return false;
    }
}

// ======================================================
// MAIN FUNCTION (Ahli 4 & Ahli 5)
// ======================================================
int main() {
    // 1. Input/Output (Ahli 4)
    string petName;
    cout << "Enter your pet's name: ";
    getline(cin, petName);

    Pet myPet(petName); // Pet object created (Classes and Objects)

    // 5. ARRAY (Ahli 2) - Can be used for menu lists
    string menuOptions[] = {"Feed", "Play", "Sleep","View Inventory", "View Status", "Save & Exit"};
    int choice;

    while (myPet.isAlive()) {
        myPet.checkStatus();
        
        cout << "\n=== ACTION MENU ===" << endl;
        // 3. CONTROL STRUCTURES (Repetition) & 5. ARRAY
        for (int i = 0; i < 6; ++i) {
            cout << i + 1 << ". " << menuOptions[i] << endl;
        }

        cout << "Your choice (1-6): ";
        // 1. INPUT/OUTPUT
        cin >> choice;

        if (cin.fail() || choice < 1 || choice > 6) {
            // Ahli 4: Input Validation
            cout << "Invalid option. Please enter numbers between 1 and 6." << endl;
            cin.clear();
            cin.ignore(10000, '\n');
            continue;
        }

        switch (choice) { // 3. CONTROL STRUCTURES (Selection)
            case 1: myPet.feed(); break;
            case 2: myPet.play(); break;
            case 3: myPet.sleep(); break;
            case 4: myPet.viewInventory(); break;
            case 5: /* checkStatus() has been called at the beginning of the loop */ break;
            case 6: 
                saveGame(myPet); // 2. File I/O
                cout << petName << " saying goodbye!" << endl;
                return 0;
        }
    }

    // Game End Logic
    cout << "\n==============================================" << endl;
    cout << "Sadly, " << petName << " has died. Game Over." << endl;
    cout << "==============================================" << endl;

    return 0;
}
